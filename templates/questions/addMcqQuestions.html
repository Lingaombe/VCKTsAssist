{% extends 'poyambira.html' %}

{% block header %}
<h1 class="h2">Add Questions</h1>
<div>
<a href="/addQuestionBank">Create New Question Bank</a>
<a> | </a>
<a href="/addQuestions">Add Descriptive</a>
</div>
{% endblock %}

{% block content %}
<!-- Quill + KaTeX -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">

<style>
  .ql-container { font-size: 14px; }
  .ql-editor { min-height: 300px; }
  .option-editor .ql-editor { min-height: 80px; }
</style>

<div>
<form action="/submitQuestion" method="POST" class="quesForm" enctype="multipart/form-data">

    <!-- Question Bank -->
    <label for="questionBank">Question Bank:</label>
    <select id="questionBank" name="questionBank" required>
        <option value="">Select Question Bank</option>
        {% for qb in QuestionBanks %}
        <option value="{{ qb.questionBankID }}">
            {{ qb.questionBankName }} {{ qb.courseID }} {{ qb.questionBankType }}
        </option>
        {% endfor %}
    </select>

    <br><br>

    <!-- MAIN QUESTION -->
    <label>Enter Question:</label><br>
    <p style="font-size:12px;color:#666;">Use Σ for formulas, sub/super for H₂O, E=mc² etc.</p>

    <div id="editor" style="background:#fff;border:1px solid #ccc;"></div>
    <textarea name="questionText" id="questionText" style="display:none;"></textarea>
    <br><br>

    <!-- OPTIONS -->
    <label>MCQ Options:</label><br>
    <p style="font-size:12px;color:#666;">You can use formulas and subscripts in options too!</p>
    {% for i in [1,2,3,4] %}
    <div style="margin: 15px 0;">
        <p><strong>Option {{ i }}:</strong></p>
        <div id='editor{{ i }}' class="option-editor" style="background:#fff;border:1px solid #ccc;"></div>
        <textarea name="option{{ i }}" id="option{{ i }}" style="display:none;"></textarea>
    </div>
    {% endfor %}

    <br>

    <!-- Difficulty -->
    <label>Difficulty (A/B/C):</label><br>
    <input name="difficulty" id="difficulty" type="text"
           pattern="[a-cA-C]+" required placeholder="A, B or C">

    <br><br>

    <!-- Unit -->
    <label>Unit:</label><br>
    <input name="unit" id="unit" type="text" pattern="[0-9]+"
           required placeholder="Enter unit">

    <br><br>

    <!-- Marks -->
    <label>Marks:</label><br>
    <input name="marks" id="marks" type="text" pattern="[0-9]+"
           required placeholder="Enter marks">

    <br><br>

    <!-- Photo -->
    <label>Upload Question Image (optional):</label><br>
    <input type="file" name="photo" accept="image/*,.pdf">

    <br><br>

    <button class="btn btn-primary" type="submit">Add Question</button>
</form>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {

    Quill.register('modules/formula', true);

    // Main question editor
    const quill = new Quill('#editor', {
        theme: 'snow',
        modules: {
            toolbar: [
                ['bold','italic','underline'],
                [{ 'script':'sub' }, { 'script':'super' }],
                ['blockquote','code-block'],
                [{ 'list':'ordered' }, { 'list':'bullet' }],
                ['link'],
                ['formula']
            ]
        }
    });

    // Option editors dictionary
    const optionEditors = {};

    // Create option editors 1–4
    for (let i = 1; i <= 4; i++) {
        optionEditors[i] = new Quill(`#editor${i}`, {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold','italic','underline'],
                    [{ 'script':'sub' }, { 'script':'super' }],
                    ['link'],
                    ['formula']
                ]
            }
        });
    }

    // On submit copy HTML to hidden textareas
    document.querySelector('.quesForm').addEventListener('submit', function() {

        // Main question
        document.querySelector('#questionText').value =
            quill.root.innerHTML;

        // Options
        for (let i = 1; i <= 4; i++) {
            document.querySelector(`#option${i}`).value =
                optionEditors[i].root.innerHTML;
        }
    });

});
</script>

{% endblock %}
